# Day 02

## Глубокое погружение в JOIN в SQL

Получение необходимых данных на основе различных структур JOIN.

## Introduction

- Для написания программ использовалась версия 15.2 PostgreSQL.
- Исходный код писался в DataGrip IDE.

## Contents

1. [Exercise 00](#exercise-00)
2. [Exercise 01](#exercise-01)
3. [Exercise 02](#exercise-02)
4. [Exercise 03](#exercise-03)
5. [Exercise 04](#exercise-04)
6. [Exercise 05](#exercise-05)
7. [Exercise 06](#exercise-06)
8. [Exercise 07](#exercise-07)
9. [Exercise 08](#exercise-08)
10. [Exercise 09](#exercise-09)
11. [Exercise 10](#exercise-10)

## Rules of the day

- Убедитесь, что у вас есть собственная база данных и доступ к ней PostgreSQL.
- Загрузите [скрипт](materials/model.sql) с моделью базы данных здесь и примените его к своей базе данных.
- Логическое представление предоставленной модели базы данных:

![schema](misc/images/schema.png)


1. **pizzeria** (Таблица с доступными пиццериями)
- поле id - первичный ключ
- поле name - название пиццерий
- поле rating - средний рейтинг пиццерии (от 0 до 5 баллов)
2. **person** (Таблица с людьми, которые любят пиццу)
- поле id - первичный ключ
- поле name - имя человека
- поле age - возраст человека
- поле gender - половая принадлежность человека
- поле address - адрес человека
3. **menu** (Таблица с доступным меню и ценой на конкретную пиццу)
- поле id - первичный ключ
- поле pizzeria_id - внешний ключ от таблицы пиццерий
- поле pizza_name - название пиццы в пиццерии
- поле price - цена конкретной пиццы
4. **person_visits** (Таблица с информацией о посещениях пиццерии)
- поле id - первичный ключ
- поле person_id - внешний ключ от таблицы с людьми
- поле pizzeria_id - внешний ключ от таблицы пиццерий
- поле visit_date - дата (например: 01.01.2022) посещения человека
5. **person_order** (Таблица с информацией о заказах людей)
- поле id - первичный ключ
- поле person_id - внешний ключ от таблицы с людьми
- поле menu_id - внешний ключ от таблицы с меню
- поле order_date - дата (например: 01.01.2022) заказа человека

Посещение человека и заказ человека являются разными сущностями и не содержат никакой корреляции между данными. Например, клиент может находиться в одном ресторане (просто просматривая меню), а в это время сделать заказ в другом по телефону или через мобильное приложение. Или другой случай, просто оказаться дома и снова позвонить с заказом без всяких посещений.

## Exercise 00

- Программа расположена в директории: ex00;
- Файл для сдачи: `day02_ex00.sql`;
- Языки: ANSI SQL.

**Недопустимо**
- SQL синтаксические конструкции: `NOT IN`, `IN`, `NOT EXISTS`, `EXISTS`, `UNION`, `EXCEPT`, `INTERSECT`.

Написан оператор SQL, который возвращает список названий пиццерий с соответствующим значением рейтинга, которые никто не посещал.

## Exercise 01

- Программа расположена в директории: ex01;
- Файл для сдачи: `day02_ex01.sql`;
- Языки: ANSI SQL;
- SQL синтаксические конструкции: `generate_series(...)`.

**Недопустимо**
- SQL синтаксические конструкции: `NOT IN`, `IN`, `NOT EXISTS`, `EXISTS`, `UNION`, `EXCEPT`, `INTERSECT`.

Написан оператор SQL, который возвращает недостающие дни с 1 по 10 января 2022 года (включая все дни) для посещений лиц с идентификаторами 1 или 2. Дни посещения упорядочены в порядке возрастания.

Образец данных с именем столбца представлен ниже:

| missing_date |
| ------ |
| 2022-01-03 |
| 2022-01-04 |
| 2022-01-05 |
| ... |

## Exercise 02

- Программа расположена в директории: ex02;
- Файл для сдачи: `day02_ex02.sql`;
- Языки: ANSI SQL.

**Недопустимо**
- SQL синтаксические конструкции: `NOT IN`, `IN`, `NOT EXISTS`, `EXISTS`, `UNION`, `EXCEPT`, `INTERSECT`.

Написан оператор SQL, который возвращает полный список имен посещенных (или не посещенных) пиццерий в период с 1 по 3 января 2022 года с одной стороны и весь список названий пиццерий, которые были посещены (или не посещены) с другой стороны. Обратите внимание на значение подстановки «-» для значений «`NULL`» в столбцах «`person_name`» и «`pizzeria_name`». Добавлено упорядочивание для всех трех столбцов.

Пример данных с необходимыми именами столбцов представлен ниже.

| person_name | visit_date | pizzeria_name |
| ------ | ------ | ------ |
| - | null | DinoPizza |
| - | null | DoDo Pizza |
| Andrey | 2022-01-01 | Dominos |
| Andrey | 2022-01-02 | Pizza Hut |
| Anna | 2022-01-01 | Pizza Hut |
| Denis | null | - |
| Dmitriy | null | - |
| ... | ... | ... |

## Exercise 03

- Программа расположена в директории: ex03;
- Файл для сдачи: `day02_ex03.sql`;
- Языки: ANSI SQL;
- SQL синтаксические конструкции: `generate_series(...)`.

**Недопустимо**
- SQL синтаксические конструкции: `NOT IN`, `IN`, `NOT EXISTS`, `EXISTS`, `UNION`, `EXCEPT`, `INTERSECT`.

Переписали оператор из упражнения № 01, используя шаблон CTE (Common Table Expression). generate_series(...) перенесен в часть CTE. Результат должен быть таким же, как в упражнении № 01.

| missing_date | 
| ------ | 
| 2022-01-03 | 
| 2022-01-04 | 
| 2022-01-05 | 
| ... |

## Exercise 04

- Программа расположена в директории: ex04;
- Файл для сдачи: `day02_ex04.sql`;
- Языки: ANSI SQL.

Найдена полная информация обо всех возможных названиях и ценах пиццерий, чтобы получить пиццу с грибами или пепперони. Отсортирован результат по названию пиццы и названию пиццерии.

Результат примера данных приведен ниже:

| pizza_name | pizzeria_name | price |
| ------ | ------ | ------ |
| mushroom pizza | Dominos | 1100 |
| mushroom pizza | Papa Johns | 950 |
| pepperoni pizza | Best Pizza | 800 |
| ... | ... | ... |

## Exercise 05

- Программа расположена в директории: ex05;
- Файл для сдачи: `day02_ex05.sql`;
- Языки: ANSI SQL.

Найдены имена всех женщин старше 25 лет и результат упорядочен по имени. Пример вывода представлен ниже.

| name | 
| ------ | 
| Elvira | 
| ... |

## Exercise 06

- Программа расположена в директории: ex06;
- Файл для сдачи: `day02_ex06.sql`;
- Языки: ANSI SQL.

Найдены все названия пицц (и соответствующие названия пиццерий с помощью таблицы «`меню`»), которые заказали Денис или Анна. Результат отсортирован по обоим столбцам. Пример вывода представлен ниже.

| pizza_name | pizzeria_name |
| ------ | ------ |
| cheese pizza | Best Pizza |
| cheese pizza | Pizza Hut |
| ... | ... |

## Exercise 07

- Программа расположена в директории: ex07;
- Файл для сдачи: `day02_ex07.sql`;
- Языки: ANSI SQL.

Найдены названия пиццерий, которую Дмитрий посетил 8 января 2022 года и где мог съесть пиццу менее чем за 800 рублей.

## Exercise 08

- Программа расположена в директории: ex08;
- Файл для сдачи: `day02_ex08.sql`;
- Языки: ANSI SQL.

Найдены имена всех мужчин из Москвы или Самары, которые заказывают пепперони или пиццу с грибами (или и то, и другое). Результат упорядочен по имени человека в порядке убывания. Пример вывода представлен ниже.

| name | 
| ------ | 
| Dmitriy | 
| ... |

## Exercise 09

- Программа расположена в директории: ex09;
- Файл для сдачи: `day02_ex09.sql`;
- Языки: ANSI SQL.

Найдены имена всех женщин, которые заказывали и пепперони, и сырную пиццу (в любое время и в любых пиццериях). Результат упорядочен по имени человека. Пример данных представлен ниже.

| name | 
| ------ | 
| Anna | 
| ... |

## Exercise 10

- Программа расположена в директории: ex10;
- Файл для сдачи: `day02_ex10.sql`;
- Языки: ANSI SQL.

Найдены имена людей, которые живут по тому же адресу. Результат упорядочен по имени 1-го лица, имени 2-го лица и общему адресу. Пример данных представлен ниже. Имена ваших столбцов соответствуют именам столбцов ниже.

| person_name1 | person_name2 | common_address | 
| ------ | ------ | ------ |
| Andrey | Anna | Moscow |
| Denis | Kate | Kazan |
| Elvira | Denis | Kazan |
| ... | ... | ... |
