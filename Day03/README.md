# Day 03

## Продолжаем JOIN и вносим изменения в данные

Изменение данных на основе языка DML.

## Introduction

- Для написания программ использовалась версия 15.2 PostgreSQL.
- Исходный код писался в DataGrip IDE.

## Contents

1. [Exercise 00](#exercise-00)
2. [Exercise 01](#exercise-01)
3. [Exercise 02](#exercise-02)
4. [Exercise 03](#exercise-03)
5. [Exercise 04](#exercise-04)
6. [Exercise 05](#exercise-05)
7. [Exercise 06](#exercise-06)
8. [Exercise 07](#exercise-07)
9. [Exercise 08](#exercise-08)
10. [Exercise 09](#exercise-09)
11. [Exercise 10](#exercise-10)
12. [Exercise 11](#exercise-11)
13. [Exercise 12](#exercise-12)
14. [Exercise 13](#exercise-13)

## Rules of the day

- Убедитесь, что у вас есть собственная база данных и доступ к ней PostgreSQL.
- Загрузите [скрипт](materials/model.sql) с моделью базы данных здесь и примените его к своей базе данных.
- Логическое представление предоставленной модели базы данных:

![schema](misc/images/schema.png)


1. **pizzeria** (Таблица с доступными пиццериями)
- поле id - первичный ключ
- поле name - название пиццерий
- поле rating - средний рейтинг пиццерии (от 0 до 5 баллов)
2. **person** (Таблица с людьми, которые любят пиццу)
- поле id - первичный ключ
- поле name - имя человека
- поле age - возраст человека
- поле gender - половая принадлежность человека
- поле address - адрес человека
3. **menu** (Таблица с доступным меню и ценой на конкретную пиццу)
- поле id - первичный ключ
- поле pizzeria_id - внешний ключ от таблицы пиццерий
- поле pizza_name - название пиццы в пиццерии
- поле price - цена конкретной пиццы
4. **person_visits** (Таблица с информацией о посещениях пиццерии)
- поле id - первичный ключ
- поле person_id - внешний ключ от таблицы с людьми
- поле pizzeria_id - внешний ключ от таблицы пиццерий
- поле visit_date - дата (например: 01.01.2022) посещения человека
5. **person_order** (Таблица с информацией о заказах людей)
- поле id - первичный ключ
- поле person_id - внешний ключ от таблицы с людьми
- поле menu_id - внешний ключ от таблицы с меню
- поле order_date - дата (например: 01.01.2022) заказа человека

Посещение человека и заказ человека являются разными сущностями и не содержат никакой корреляции между данными. Например, клиент может находиться в одном ресторане (просто просматривая меню), а в это время сделать заказ в другом по телефону или через мобильное приложение. Или другой случай, просто оказаться дома и снова позвонить с заказом без всяких посещений.

## Exercise 00

- Программа расположена в директории: ex00;
- Файл для сдачи: `day03_ex00.sql`;
- Языки: ANSI SQL.

Написан оператор SQL, который возвращает список названий пицц, цен на пиццу, названий пиццерий и дат посещения для Кати и цен в диапазоне от 800 до 1000 рублей. Отсортирована пицца по цене и названию пиццерии. Образец данных ниже.

| pizza_name | price | pizzeria_name | visit_date |
| ------ | ------ | ------ | ------ |
| cheese pizza | 950 | DinoPizza | 2022-01-04 |
| pepperoni pizza | 800 | Best Pizza | 2022-01-03 |
| pepperoni pizza | 800 | DinoPizza | 2022-01-04 |
| ... | ... | ... | ... |

## Exercise 01

- Программа расположена в директории: ex01;
- Файл для сдачи: `day03_ex01.sql`;
- Языки: ANSI SQL.

**Недопустимо**
- SQL синтаксические конструкции: любые типы `JOINs`.

Найдены все идентификаторы меню, которые никем не заказаны. Результат отсортирован по идентификаторам. Пример выходных данных представлен ниже.

| menu_id |
| ------ |
| 5 |
| 10 |
| ... |

## Exercise 02

- Программа расположена в директории: ex02;
- Файл для сдачи: `day03_ex02.sql`;
- Языки: ANSI SQL.

Использован оператор SQL из упражнения № 01 и показаны названия пицц из пиццерий, которые никем не заказаны, включая соответствующие цены. Результат отсортирован по названию и цене пиццы. Пример выходных данных представлен ниже.

| pizza_name | price | pizzeria_name |
| ------ | ------ | ------ |
| cheese pizza | 700 | Papa Johns |
| cheese pizza | 780 | DoDo Pizza |
| ... | ... | ... |

## Exercise 03

- Программа расположена в директории: ex03;
- Файл для сдачи: `day03_ex03.sql`;
- Языки: ANSI SQL.

Найдены объединения пиццерий, которые посещали женщины или мужчины. Другими словами, набор названий пиццерий, которые посещали только женщины, и выполнена операция «`UNION`» с набором названий пиццерий, которые посещали только мужчины. Обратите внимание на слово «`только`» для обоих полов. Для любых операторов SQL с наборами сохранены дубликаты (конструкции `UNION ALL`, `EXCEPT ALL`, `INTERSECT ALL`). Результаты отсортированы по названию пиццерии. Пример данных представлен ниже.

| pizzeria_name | 
| ------ | 
| Best Pizza | 
| Dominos |
| ... |

## Exercise 04

- Программа расположена в директории: ex04;
- Файл для сдачи: `day03_ex04.sql`;
- Языки: ANSI SQL.

Найдено объединение пиццерий, которые имеют заказы как от женщин, так и от мужчин. Другими словами, найден набор названий пиццерий, заказанных только женщинами, и выполнена операция `UNION` с набором названий пиццерий, заказанных только мужчинами. Обратите внимание на слово «`только`» для обоих полов. Для любых операторов SQL с наборами дубыликаты не были сохранены (`UNION`, `EXCEPT`, `INTERSECT`). Результаты отсортированы по названию пиццерии. Пример данных представлен ниже.


| pizzeria_name | 
| ------ | 
| Papa Johns | 

## Exercise 05

- Программа расположена в директории: ex05;
- Файл для сдачи: `day03_ex05.sql`;
- Языки: ANSI SQL.

Написан SQL-запрос, который возвращает список пиццерий, которые Андрей посетил, но не сделал заказов. Результат отсортирован по названию пиццерии. Образец данных представлен ниже.

| pizzeria_name | 
| ------ | 
| Pizza Hut | 

## Exercise 06

- Программа расположена в директории: ex06;
- Файл для сдачи: `day03_ex06.sql`;
- Языки: ANSI SQL.

Найдены одинаковые названия пицц по одинаковой цене, но из разных пиццерий. Результат упорядочен по названию пиццы. Имена столбцов соответствуют именам столбцов в примере.

Пример данных представлен ниже.

| pizza_name | pizzeria_name_1 | pizzeria_name_2 | price |
| ------ | ------ | ------ | ------ |
| cheese pizza | Best Pizza | Papa Johns | 700 |
| ... | ... | ... | ... |

## Exercise 07

- Программа расположена в директории: ex07;
- Файл для сдачи: `day03_ex07.sql`;
- Языки: ANSI SQL.

Зарегистрирована новая пицца с названием «greek pizza» (использовано id = 19) и ценой 800 рублей в ресторане «Dominos» (pizzeria_id = 2).
**Внимание**: это упражнение, вероятно, станет причиной неправильного изменения данных. Собственно, восстановить исходную модель базы данных можно по данным по ссылке в разделе «Rules of the day».

## Exercise 08

- Программа расположена в директории: ex08;
- Файл для сдачи: `day03_ex08.sql`;
- Языки: ANSI SQL.

**Недопустимо**
- SQL синтаксические конструкции: нельзя использовать точные номера для идентификаторов первичного ключа и пиццерии.

Зарегистрирована новая пицца с названием «sicilian pizza» (идентификатор которой рассчитывался по формуле «максимальное значение идентификатора + 1») по цене 900 рублей в ресторане «Dominos» (для получения идентификатора пиццерии использовался внутренний запрос).
**Внимание**: это упражнение, вероятно, станет причиной неправильного изменения данных. Собственно, восстановить исходную модель базы данных можно с помощью данных по ссылке в разделе «Rules of the day» и повторного сценария из упражнения 07.

## Exercise 09

- Программа расположена в директории: ex09;
- Файл для сдачи: `day03_ex09.sql`;
- Языки: ANSI SQL.

**Недопустимо**
- SQL синтаксические конструкции: нельзя использовать точные номера для идентификаторов первичного ключа и пиццерии.

Зарегистрированы новые посещения ресторана Dominos от Дениса и Ирины 24 февраля 2022 года.
**Внимание**: это упражнение, вероятно, станет причиной неправильного изменения данных. Собственно, восстановить исходную модель базы данных можно с помощью данных по ссылке в разделе «Rules of the day» и повторного сценария из упражнения 07 и 08.

## Exercise 10

- Программа расположена в директории: ex10;
- Файл для сдачи: `day03_ex10.sql`;
- Языки: ANSI SQL.

**Недопустимо**
- SQL синтаксические конструкции: нельзя использовать точные номера для идентификаторов первичного ключа и пиццерии.

Зарегистрированы новые заказы от Дениса и Ирины 24 февраля 2022 года на новое меню с «sicilian pizza».
**Внимание**: это упражнение, вероятно, станет причиной неправильного изменения данных. Собственно, восстановить исходную модель базы данных можно с помощью данных по ссылке в разделе «Rules of the day» и повторного сценария из упражнения 07, 08 и 09.

## Exercise 11

- Программа расположена в директории: ex11;
- Файл для сдачи: `day03_ex11.sql`;
- Языки: ANSI SQL.
    
Изменена цена на «greek pizza» на -10% от текущего значения.
**Внимание**: это упражнение, вероятно, станет причиной неправильного изменения данных. Собственно, восстановить исходную модель базы данных можно с помощью данных по ссылке в разделе «Rules of the day» и повторного сценария из упражнения 07, 08, 09 и 10.

## Exercise 12

- Программа расположена в директории: ex12;
- Файл для сдачи: `day03_ex12.sql`;
- Языки: ANSI SQL;
- SQL синтаксические конструкции: `generate_series(...)`;
- SQL шаблон синтаксиса: использован паттерн "insert-select".
`INSERT INTO ... SELECT ...`

**Недопустимо**
- SQL синтаксические конструкции: нельзя использовать точные номера для идентификаторов первичного ключа и menu;
- Нельзя использовать оконные функции, как `ROW_NUMBER( )`;
- Нельзя использовать атомарные операторы `INSERT`.

Зарегистрированы новые заказы от всех лиц на «греческую пиццу» до 25 февраля 2022 года.
**Внимание**: это упражнение, вероятно, станет причиной неправильного изменения данных. Собственно, восстановить исходную модель базы данных можно с помощью данных по ссылке в разделе «Rules of the day» и повторного сценария из упражнения 07, 08, 09, 10 и 11.

## Exercise 13

- Программа расположена в директории: ex13;
- Файл для сдачи: `day03_ex13.sql`;
- Языки: ANSI SQL.
    
Написаны 2 оператора SQL (DML), которые удаляют все новые заказы из упражнения № 12 в зависимости от даты заказа. Удалена из меню «greek pizza».
**Внимание**: это упражнение, вероятно, станет причиной неправильного изменения данных. Собственно, восстановить исходную модель базы данных можно с помощью данных по ссылке в разделе «Rules of the day» и повторного сценария из упражнения 07, 08, 09, 10, 11 и 12.
